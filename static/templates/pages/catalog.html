{{template "base" .}}

{{define "content"}}
<div class="container catalog-container">
    
    <div class="catalog-header">
        <h1>All Vehicles</h1>
        <p class="text-muted">{{len .Cars}} cars available</p>
    </div>

    {{if .CompareIDs}}
    <div class="compare-bar">
        <div class="compare-bar-content">
            <span class="compare-count">
                <strong>Selection Active</strong>
            </span>
            <div class="compare-actions">
                <a href="/catalog{{replaceParam .Params "compare_ids" ""}}" class="btn btn-sm btn-secondary">Clear</a>
                
                <a href="/compare?ids={{.CompareIDs}}" class="btn btn-sm btn-primary">
                    Compare Now &rarr;
                </a>
            </div>
        </div>
    </div>
    {{end}}

    <div class="catalog-layout">
        
        <aside class="catalog-sidebar">
            <form action="/catalog" method="GET" class="filter-form">
                
                <div class="filter-group">
                    <label>Manufacturer</label>
                    <select name="manufacturer_id">
                        <option value="">All Makes</option>
                        {{range .Metadata.Manufacturers}}
                            <option value="{{.ID}}" {{if eq .ID $.Filters.ManufacturerID}}selected{{end}}>
                                {{.Name}}
                            </option>
                        {{end}}
                    </select>
                </div>

                <div class="filter-group">
                    <label>Body Type</label>
                    <select name="category_id">
                        <option value="">All Types</option>
                        {{range .Metadata.Categories}}
                            <option value="{{.ID}}" {{if eq .ID $.Filters.CategoryID}}selected{{end}}>
                                {{.Name}}
                            </option>
                        {{end}}
                    </select>
                </div>

                <div class="filter-group">
                    <label>Min Year: {{.Filters.MinYear}}</label>
                    <input type="number" name="min_year" placeholder="e.g. 2018" value="{{if .Filters.MinYear}}{{.Filters.MinYear}}{{end}}">
                </div>

                <div class="filter-group">
                    <label>Min Power (hp)</label>
                    <input type="number" name="min_hp" placeholder="e.g. 150" value="{{if .Filters.MinHP}}{{.Filters.MinHP}}{{end}}">
                </div>

                <div class="filter-group">
                    <label>Transmission</label>
                    <select name="transmission">
                        <option value="">Any</option>
                        {{range .Metadata.Transmissions}}
                            <option value="{{.}}" {{if eq . $.Filters.Transmission}}selected{{end}}>
                                {{.}}
                            </option>
                        {{end}}
                    </select>
                </div>

                <div class="filter-group">
                    <label>Drive Type</label>
                    <select name="drivetrain">
                        <option value="">Any</option>
                        {{range .Metadata.Drivetrains}}
                            <option value="{{.}}" {{if eq . $.Filters.Drivetrain}}selected{{end}}>
                                {{.}}
                            </option>
                        {{end}}
                    </select>
                </div>

                <div class="filter-actions">
                    <button type="submit" class="btn btn-primary full-width">Apply Filters</button>
                    <a href="/catalog" class="btn btn-secondary full-width justify-center">Reset</a>
                </div>

            </form>
        </aside>

        <main class="catalog-grid">
            {{if .Cars}}
                <div class="grid grid-4">
                    {{range .Cars}}
                        {{template "card" dict "Car" . "AllowCompare" true "SelectedMap" $.SelectedMap "LimitReached" $.LimitReached "CompareIDs" $.CompareIDs "Params" $.Params}}
                    {{end}}
                </div>
            {{else}}
                <div class="empty-state">
                    <h3>No cars found ðŸ˜”</h3>
                    <p class="text-muted">Try adjusting your filters.</p>
                </div>
            {{end}}
        </main>
    </div>
</div>
{{end}}